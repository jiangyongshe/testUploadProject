var page=1,pageSize=10;
$(function(){
	$("#headerTitle").text("播放历史");
	initMescroll();//初始化下拉控件
	appendDetailDiv();
})

/*上拉加载的回调 page = {num:1, size:10}; num:当前页 从1开始, size:每页数据条数 */
function upCallback(page){
	//联网加载数据
	console.log("page.num="+page.num);
	loadHistoryAdvertise({pageNo:page.num,pageSize:pageSize,beginTime:bgDt,endTime:edDt});
}

//加载用户视频播放历史记录
function loadHistoryAdvertise(obj){
	jsonAjax("/"+language+"/customer/queryVedioPlayHistory.do",obj,function(res){
		if(res.data.list.length>0){
			var data=res.data;
			var listDom=document.getElementById("dataList");
			for (var i = 0; i < data.list.length; i++) {
				var dto=data.list[i];
				if(dto.pics!=null&&dto.pics!=""){
					imgs=dto.pics.split(",");
				}
				var str='<div class="ggdp-list1-tp pos-a">';
				str+='<span><img src="'+imagePath+imgs[0]+'" /></span>';
				str+='</div>';
				str+='<div class="ggdp-list1-nr">';
				str+='<p class="col-999 pad-t2">设备编号：<span class="col-666">'+dto.device_id+'</span></p>';
				str+='<p class="col-999">店铺名称：<span class="col-666">'+dto.shopName+'</span></p>';
				str+='<p class="col-999">广告名称：<span class="col-666">'+dto.vedio_name+'</span></p>';
				str+='<p class="col-999">播放开始时间：<span class="col-666">'+dto.beginTime+'</span></p>';
				str+='<p class="col-999">播放结束时间：<span class="col-666">'+dto.endTime+'</span></p>';
				str+='</div>';
				
				var liDom=document.createElement("li");
				liDom.innerHTML=str;
				listDom.appendChild(liDom);//加在列表的后面,上拉加载
			}
		}
	},function(){},"get");
}

//清空时间
function clearDate(){
	$(".beginTime").val("");
	$(".endTime").val("");
}
//加入详情弹出框
function appendDetailDiv(){
	var html='<div class="shade" id="tc-eject2" style="display: ;">';
	html+='  <span class="cd-close2 text-c pad-l5" onclick="javascript:turnoff(\'tc-eject2\')" title="关闭"></span>';
	html+='  <ul class="screen-list screen-list2">';
	html+='	    <li>';
	html+='        <p><b>店铺名称：</b><span class="shopName"></span></p>';
	html+='        <p class="pad-t7"><b>详细地址：</b><span class="addrDetail"></span></p>';
	html+='        <div class="dp-tp imgs">';
	html+='        </div>';
	html+='     </li>';
	html+='     <li>';
	html+='        <button name="" type="button" onclick="javascript:turnoff(\'tc-eject2\')" class="btn btn03 bg-blue bor-rad font13 width100 mar-t10 mar-b10">关闭</button>';
	html+='     </li>';
	html+='  </ul>';
	html+='</div>';
	$("body").append(html);
}
//点击店铺名店铺详情信息
function showShopDetail(shopName,addr,imgs){
	$(".shopName").text(shopName);
	if(addr!=null){
		var addrList=addr.split("*");
		if(addrList[0]==addrList[1]){
			addr=addr.replace(addrList[0],"");
		}
	}
	$(".addrDetail").text(addr.replace(/\*/g,"").replace(/&/g,""));
	$(".imgs").html("");
	if(imgs!="null"){
		var imgList=imgs.split(","),str="";
		for (var i = 0; i < imgList.length; i++) {
			str+='<img src="'+imagePath+imgList[i]+'"/>';//onclick="showPicPopup(this.cloneNode(true),event)"
		}
		$(".imgs").html(str);
	}
	$("#tc-eject2").show();
}
